function pc_media_remove(e){e.prevAll(".pc-media-id").val(""),e.prevAll(".pc-media-preview").slideUp("500",(function(){jQuery(this).empty().show(),e.prev(".pc-media-select").val("Ajouter"),e.remove()}))}function pc_media_modal(e){var t,a,r=e.parent(),i=r.find(".pc-media-preview"),n=r.find(".pc-media-id"),l=e.data("type");switch(l){case"image":t={title:"Insérer une image",library:{type:"image"},button:{text:"Insérer une image"},multiple:!1};break;case"pdf":t={title:"Insérer un pdf",library:{type:"application/pdf"},button:{text:"Insérer un pdf"},multiple:!1};break;case"file":t={title:"Insérer un fichier",button:{text:"Insérer un fichier"},multiple:!1};break;case"audio":t={title:"Insérer un fichier audio",library:{type:"audio/mpeg"},button:{text:"Insérer un fichier audio"},multiple:!1}}(a=wp.media(t)).on("select",(function(){var t,o=a.state().get("selection").first().toJSON();switch(n.val(o.id),l){case"image":t='<div class="pc-media-preview-item" style="background-image:url('+(o.sizes.hasOwnProperty("thumbnail")?o.sizes.thumbnail.url:o.url).replaceAll(" ","%20")+');"></div>';break;case"audio":t='<audio class="pc-audio-preview" controls src="'+o.url.replaceAll(" ","%20")+'"></audio>';default:t='<a class="pc-pdf-preview" href="'+o.url.replaceAll(" ","%20")+'" target="_blank"><div class="dashicons dashicons-media-default"></div> Voir le fichier</a>'}i.html(t),e.val("Modifier"),"active"==e.data("remove")&&0==r.find(".pc-media-remove").length&&(e.after('<input class="button pc-media-remove" data-cible="image" type="button" value="Supprimer"/>'),r.find(".pc-media-remove").click((function(){pc_media_remove(jQuery(this))})))})),a.open()}jQuery(document).ready((function(e){var t=e(".pc-metabox").find('input[type="date"], input[type="time"], input[type="datetime-local"]');if(t.length>0){var a=function(e,t){t.attr("min",e.val())};t.each((function(){if(this.hasAttribute("data-after")){var t=e("#"+e(this).attr("data-after")),r=e(this);e(this).attr("min",t.val()),""!=t.val()&&a(t,r),t.on("input",(function(){a(t,r)}))}}))}var r=e(".pc-date-picker");if(r.length>0){$pcDateRemove=e(".pc-date-remove");var i=function(){e(this).prev(".pc-date-picker").val(""),e(this).remove()};r.datepicker({closeText:"Fermer",prevText:"Précédent",nextText:"Suivant",currentText:"Aujourd'hui",monthNames:["janvier","février","mars","avril","mai","juin","juillet","août","septembre","octobre","novembre","décembre"],monthNamesShort:["janv.","févr.","mars","avr.","mai","juin","juil.","août","sept.","oct.","nov.","déc."],dayNames:["dimanche","lundi","mardi","mercredi","jeudi","vendredi","samedi"],dayNamesShort:["dim.","lun.","mar.","mer.","jeu.","ven.","sam."],dayNamesMin:["D","L","M","M","J","V","S"],weekHeader:"Sem.",dateFormat:"dd MM yy",firstDay:1,isRTL:!1,showMonthAfterYear:!1,yearSuffix:"",onSelect:function(){e(this).next(".pc-date-remove").length<1&&!e(this).prop("required")&&(e(this).after('<button class="reset-btn pc-date-remove" type="button" title="Supprimer"><span class="dashicons dashicons-no-alt"></span></button>'),e(this).next(".pc-date-remove").click(i))}}),$pcDateRemove.length>0&&$pcDateRemove.click(i);var n=r.filter("[required]");n.length>0&&e("form#post").submit((function(t){var a=!1,r=!1;n.each((function(){""==e(this).val()?(e(this).hasClass("pc-field-error")||e(this).addClass("pc-field-error").after('<p><em class="description pc-message-error">Ce champ est obligatoire.</em></p>'),dateRequired=!0,a||(a=!0,r=e(this))):e(this).hasClass("pc-field-error")&&e(this).removeClass("pc-field-error").next("p").remove()})),a&&(t.preventDefault(),e("html, body").animate({scrollTop:r.offset().top-50},500))}))}})),jQuery(document).ready((function(e){var t=e(".pc-address-to-gps");if(t.length>0){var a=new google.maps.Geocoder;t.each((function(t){var r,i,n,l,o=e(this),c=o.find(".address"),s=o.find(".cp"),p=o.find(".city"),d=o.find(".lat"),u=o.find(".lng"),m="map-"+t;o.after('<div id="'+m+'" style="height:300px;margin-right:10px"></div>'),""!=d.val()&&""!=u.val()?(r=new google.maps.LatLng(d.val(),u.val()),i=15):(r=new google.maps.LatLng(46.8518280627862,2.4293935625),i=5),n=new google.maps.Map(document.getElementById(m),{zoom:i,center:r,controlSize:30,streetViewControl:!1,fullscreenControl:!1,mapTypeControl:!1,styles:[{featureType:"poi",stylers:[{visibility:"off"}]}]}),(l=new google.maps.Marker({position:r,draggable:!0})).setMap(n),google.maps.event.addListener(l,"dragend",(function(e){var t=e.latLng;d.val(t.lat()),u.val(t.lng()),n.setCenter(t)})),o.find("button").click((function(){""!=c.val()?""!=s.val()?""!=p.val()?(addresseToConvert=c.val()+" "+s.val()+" "+p.val(),a.geocode({address:addresseToConvert},((e,t)=>{if("OK"==t){var a=e[0].geometry.location;d.val(a.lat()),u.val(a.lng()),l.setPosition(a),n.setCenter(a),n.setZoom(15)}else"ZERO_RESULTS"==t?alert("L'adresse n'a pas été trouvée."):alert("Une erreur est survenue, merci de le signaler à Papier Codé.")}))):alert("Le champ Ville est obligatoire."):alert("Le champ Code Postal est obligatoire."):alert("Le champ Adresse est obligatoire.")}))}))}})),jQuery(document).ready((function(e){var t=e("body");t.on("click",".pc-media-select[data-type]",(function(){pc_media_modal(e(this))})),t.on("click",".pc-media-remove",(function(){pc_media_remove(e(this))}));var a,r=e(".pc-gallery-select");r.length>0&&r.click((function(){var t=e(this),a=e(this).parent(),r=a.find(".pc-media-id"),i=r.val();if(gallery_state=i?"gallery-edit":"gallery-library",n)n.open();else{var n=wp.media({title:"Insérer une gallerie",button:{text:"Insérer une gallerie"},library:{type:"image"},frame:"post",state:gallery_state,multiple:!0});n.on("open",(function(){if(i=r.val()){i=i.split(",");var e=n.state().get("library");i.forEach((function(t){attachment=wp.media.attachment(t),attachment.fetch(),e.add(attachment?[attachment]:[])}))}})),n.on("update",(function(){for(var i=n.state().get("library").toJSON(),l=[],o="",c=0;c<i.length;c++)l.push(i[c].id),o+='<div class="pc-media-preview-item" style="background-image:url('+(i[c].sizes.hasOwnProperty("thumbnail")?i[c].sizes.thumbnail.url:i[c].url).replaceAll(" ","%20")+');"></div>';r.val(l.join()),a.find(".pc-media-preview").html(o),t.val("Modifier"),$btn_Remove=a.find(".pc-media-remove"),"active"==t.data("remove")&&0==$btn_Remove.length&&(t.after('<input class="button pc-media-remove" data-cible="gallery" type="button" value="Supprimer"/>'),a.find(".pc-media-remove").click((function(){pc_media_remove(e(this))})))})),n.open()}})),t.on("click",".pc-link-select",(function(){t.addClass("pc-modal-link"),a=e(this).data("cible"),wpActiveEditor=!0,wpLink.open(a)})),t.on("click","#wp-link-submit",(function(r){e("#"+a).val(wpLink.getAttrs().href),wpLink.close(),t.removeClass("pc-link-modal")})),t.on("click","#wp-link-cancel, #wp-link-backdrop, #wp-link-close",(function(e){wpLink.close(),t.removeClass("pc-link-modal")}))})),document.addEventListener("DOMContentLoaded",(()=>{document.querySelectorAll(".posts-selector").forEach((e=>{const t=JSON.parse(e.dataset.posts),a=e.querySelector(".posts-selector-list"),r=e.querySelector(".pc-repeater-more"),i=e.querySelector(".posts-selector-target"),n=""!=i.value?i.value.split(","):[];let l=[];function o(e=-1){let r=document.createElement("div");r.classList.add("posts-selector-item");let i=document.createElement("select");i.dataset.from="";let n=document.createElement("option");i.append(n),t.forEach((t=>{let a=document.createElement("option");a.setAttribute("value",t.id),t.id==e?(a.setAttribute("selected",""),i.dataset.from=e):l.includes(t.id)&&(a.style.display="none"),a.innerText=t.title,i.append(a)})),i.addEventListener("change",(e=>{let t=a.querySelectorAll("select"),r=e.target,i=r.value,n=r.dataset.from;""!==i&&(t.forEach((e=>{r!==e&&(e.querySelector('option[value="'+i+'"]').style.display="none")})),l.push(parseInt(i))),i!==n&&(t.forEach((e=>{r!==e&&""!=n&&(e.querySelector('option[value="'+n+'"]').style.display="block")})),l=l.filter((e=>e!=r.dataset.from))),r.dataset.from=i,c()})),r.append(i);let o=document.createElement("span");o.setAttribute("title","Supprimer"),o.classList.add("pc-repeater-btn-trash","dashicons","dashicons-trash"),o.addEventListener("click",(e=>{let t=e.target.parentNode,r=t.querySelector("select").value;if(""!=r){a.querySelectorAll("select").forEach((e=>{e.querySelector('option[value="'+r+'"]').style.display="block"}))}l=l.filter((e=>e!=t.querySelector("select").value)),t.remove(),c()})),r.append(o);let s=document.createElement("span");s.setAttribute("title","Déplacer"),s.classList.add("pc-repeater-btn-move","dashicons","dashicons-move"),r.append(s),a.append(r)}function c(){let e=[];a.querySelectorAll("select").forEach((t=>{e.push(t.value)})),i.value=e.join(),console.log("toSave",e.join()),console.log("selectedIds",l)}n.length>0&&(n.forEach((e=>{l.push(parseInt(e))})),l.forEach((e=>{o(parseInt(e))}))),r.addEventListener("click",o);let s=jQuery(a);s.sortable({handle:".pc-repeater-btn-move"}),s.on("sortupdate",c)}))})),jQuery(document).ready((function(e){var t=e(".pc-repeater");t.length>0&&t.each((function(){var t=e(this),a=t.data("fields").split(","),r=t.nextAll(".pc-repeater-target"),i=t.nextAll(".pc-repeater-more"),n=t.nextAll(".pc-repeater-src"),l=function(){var i="";t.children().each((function(){var t=e(this),r="";a.forEach((function(e){r+="["+e+"]"+t.find("[name="+e+"]").val()+"[/"+e+"]"})),""==i?i=r:i+="[/]"+r})),console.log(i),r.val(i)};t.on("focusout","input, textarea, select",(function(e){l()})),t.on("click",".pc-repeater-btn-trash",(function(){e(this).parents(".pc-repeater-item").remove(),l()})),i.click((function(){n.clone().html((function(e,a){return a.replaceAll("[index]",t.children().length)})).appendTo(t).removeClass("pc-repeater-src").find('input[data-required="required"]').prop("required",!0)})),t.sortable({handle:".pc-repeater-btn-move",placeholder:"pc-repeater-placeholder"}),t.on("sortupdate",(function(e,t){l()}))}))})),jQuery(document).ready((function(e){var t=e(".pc-color-picker");t.length>0&&t.change((function(){""!==e(this).val()?e(this).css("background-color",e(this).val()):e(this).css("background-color","#fff")}));var a=e(".pc-counter");a.length>0&&a.each((function(){var t=e(this).data("counter-max"),a=e(this).val().length,r=a>t?'style="color:red"':'style="color:green"';e(this).after('<p class="description" '+r+'><span class="pc-counter-msg">'+a+"</span> / "+t+" caractères conseillés.</p>"),e(this).on("keyup mouseout",(function(){var a=e(this).val().length,r=e(this).next();a>t?r.css("color","red"):r.css("color","green"),e(this).next().children().text(a)}))}));var r=e(".pc-checkboxes-required"),i=function(e){e.filter(":checked").length>0?e.prop("required",!1):e.prop("required",!0)};r.length>0&&r.each((function(){var t=e(this).find("input");i(t),t.on("click",(function(){i(t)}))}))}));